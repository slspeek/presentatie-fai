\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage[dutch]{babel}
\usepackage{keystroke}
\usepackage{booktabs}
\usepackage{bbding} 
\usepackage{datetime}
\newdate{date}{20}{09}{2025}

\usepackage{hyperref}
% colored links
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
}

\usetheme{Madrid}
\usecolortheme{default}
% \setbeamercolor{frametitle}{bg=orange,fg=black}
\definecolor{NLLGGOrange}{RGB}{255,146,10}
\setbeamercolor{title}{bg=NLLGGOrange,fg=black}
\setbeamercolor{frametitle}{bg=NLLGGOrange,fg=black}
\setbeamercolor{structure}{fg=NLLGGOrange}

\newcommand{\light}[1]{\textcolor{gray}{#1}}


%------------------------------------------------------------
%This block of code defines the information to appear in the
%Title page
\title[Fully Automatic Install] %optional
{Fully Automatic Installation (FAI)}

\author[S.L.Speek] % (optional)
{Steven L. Speek}

\institute[NLLGG] % (optional)
{
  Nederlandse Linux Gebruikers Groep 
}

% \date[\today{}] {\today{}}
\date{\displaydate{date}}

\logo{\includegraphics[height=1cm]{img/nllgg-logo.jpg}}

%End of title page configuration block
%------------------------------------------------------------



%------------------------------------------------------------
%The next block of commands puts the table of contents at the 
%beginning of each section and highlights the current section:

% \AtBeginSection[]
% {
%   \begin{frame}<handout:0>
%     \frametitle{Inhoudsopgave}
%     \tableofcontents[currentsection]
%   \end{frame}
% }
\newif\iflattersubsect

\AtBeginSection[] {
    \begin{frame}<beamer>
      \frametitle{Inhoudsopgave}
      \tableofcontents[currentsection]
     \end{frame}
    \lattersubsectfalse
}

\AtBeginSubsection[] {
    \iflattersubsect
    \begin{frame}<beamer>
      \frametitle{Inhoudsopgave}
      \tableofcontents[currentsubsection]
    \end{frame}
    \fi
    \lattersubsecttrue
}
%------------------------------------------------------------


\begin{document}

%The next statement creates the title page.
\frame{\titlepage}


%---------------------------------------------------------
%This block of code is for the table of contents after
%the title page
\begin{frame}
\frametitle{Inhoudsopgave}
\tableofcontents
\end{frame}
%---------------------------------------------------------


\section{Over mij}

%---------------------------------------------------------
\begin{frame}
\frametitle{Steven L. Speek}
\begin{itemize}
  \item Debian gebruiker sinds Sarge (2005)
  \item Actief bij \href{https://linux020.nl/}{Linux\textsuperscript{020}}
  \item Ontwikkelaar in Python en Java  
  \item Linux netwerkbeheerder
  \item Docent Linux
  \item Github: \url{https://github.com/slspeek}
  \item Hardloper: Volg mij op \href{https://www.strava.com/athletes/123214921}{Strava}
\end{itemize}

\end{frame}
%---------------------------------------------------------
\section{Probleemstelling}
\begin{frame}
\frametitle{Probleemstelling}
Na een Linux installatie ga je telkens een paar dingetjes aanpassen:
\begin{itemize}
  \item Upstream Firefox installeren
  \item Mattermost installeren
  \item Elements installeren
  \item VLC installeren
  \item Gnome Tweaks installeren
  \item Mooie BASH prompt, met foutmeldingen, configureren
  \item Sneltoetsen instellen
  \item Mooie background instellen
  \item Enzovoorts
\end{itemize}
Dit kost tijd, en is foutgevoelig. Bovendien had je in die tijd uitleg kunnen geven over Linux.
\end{frame}
\section{Oplossingen}
\begin{frame}
\frametitle{Oplossingen}
Voor Debian gebaseerde systemen zijn er een paar oplossingen:
\begin{itemize}
  \item \href{https://wiki.debian.org/DebianInstaller/Preseed}{Preseed} 
  \begin{itemize}
    \item Eenvoudig
    \item Beperkt
    \item Alleen voor installatie
    \item \href{https://slspeek.github.io/debian/}{Mijn preseed bestanden}
  \end{itemize}
  \item \href{https://fai-project.org/}{FAI - Fully Automatic Installation}
  \begin{itemize}
     \item Zeer volwassen project
     \item Goed ontwerp
     \item \href{https://slspeek.github.io/fai/}{Mijn FAI configuratie}
     \item \href{https://slspeek.github.io/fai-cmds/}{Mijn FAI commando's} 
  \end{itemize}
  \item \href{https://ansible.com/}{Ansible}
  \begin{itemize}
     \item Heel flexibel
     \item Niet specifiek voor Debian
     \item Niet specifiek voor installatie
     \item Vereist SSH toegang
  \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Vergelijking van mijn Preseed en FAI}
\begin{table} % [htbp] suggests placement options: here, top, bottom, page
    \centering % Centers the table on the page
    \caption{Vergelijking} % Table caption

    \begin{tabular}{lccccc} % Defines column alignment: l=left, c=center, r=right
        \toprule % Top rule (from booktabs package)
        \textbf{Oplossing} & \textbf{Auto} & \textbf{Multiboot} & \textbf{User} & \textbf{Live}  & \textbf{Live persistentie}\\
        \midrule % Mid rule (from booktabs package)
        Mijn preseed & \XSolid & \Checkmark & \Checkmark & \Checkmark & \Checkmark \\
        FAI & \Checkmark & \XSolid & \XSolid & \Checkmark & \XSolid \\
        \bottomrule % Bottom rule (from booktabs package)
    \end{tabular}
\end{table}
\end{frame}

\begin{frame}
\frametitle{Motivatie voor FAI}
Nadelen van \href{https://slspeek.github.io/debian/}{Mijn Preseed}:
\begin{itemize}
  \item Bestanden meegeven moeilijk
  \item Moeilijk uitbreidbaar
  \item Amateuristische herbouw van FAI
  \item Geen scheiding mechaniek en configuratie
  \item Geen i18n
  \item Live en installatie zijn niet hetzelfde
\end{itemize}
Voordelen van FAI:
\begin{itemize}
  \item Goed ontwerp
  \item Zeer uitgebreid
  \item Actief project
  \item Veel voorbeelden
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Maanschot idee}
Draai FAI vanuit het late-command in een preseed.
\centering
\includegraphics[width=0.5\textwidth]{img/Cartoon_space_rocket.png}<1->
\end{frame}

\section{Wat is FAI?}
\begin{frame}
\frametitle{Wat is FAI?}
\begin{itemize}
  \item Fully Automatic Installation
  \item Automatische installatie van Linux systemen
  \item \textbf{Debian}, Ubuntu, Mint, CentOS, Rocky Linux, AlmaLinux, ...
  \item Netwerk installatie
  \item \textbf{Live installatie}
  \item Herinstallatie
  \item \textbf{USB installatie}
  \item Chroot installatie
\end{itemize}
\end{frame}

\section{FAI componenten}
\begin{frame}
\frametitle{FAI componenten}
\begin{itemize}
  \item FAI software
  \begin{itemize}
    \item Canoniek \url{https://fai-project.org}
    \item Persoonlijk \url{https://github.com/slspeek/fai-cmds}
  \end{itemize}
  \item FAI configuratie
  \begin{itemize}
    \item Canoniek \url{https://github.com/faiproject/fai-config}
    \item Persoonlijk \url{https://slspeek.github.io/fai/}
  \end{itemize}
\end{itemize}
\end{frame}

\section{Classes: Dingetjes automatiseren in FAI}
\begin{frame}
\frametitle{Dingetjes automatiseren in FAI}
Een \textbf{CLASS} kan bestaan uit:
\begin{itemize} 
  \item Verseisten dat bepaalde CLASSES zijn gedraaid
  \item Pakketten lijst
  \item Antwoorden op \href{https://wiki.debian.org/PackageManagement/Preseed}{debconf vragen}
  \item (Configuratie) bestanden
  \item Scripts
  \item<2-> Hooks
  \begin{itemize}
    \item Script dat voor een bepaalde FAI-fase wordt gedraaid
    \begin{itemize}
      \item Bijvoorbeeld \texttt{instsoft} om voordat de pakketten worden geïnstalleerd iets te doen
      \end{itemize}
  \end{itemize}
  \item<3-> \light{Lokale pakketten}
  \item<3-> \light{Variabelen}
  \item<3-> \light{Disklayout}
  \item<3-> \light{Tests}
\end{itemize}
\end{frame}

\section{Configuratie nader bezien}
\begin{frame}
\frametitle{Configuratie nader bezien}
Configuratie is een map met:
\begin{itemize}
  \item \texttt{classes/} - Klasse variabelen en afhankelijkheden
  \item<2-> \texttt{package\_config/}  Pakketten lijsten
  \item<3-> \texttt{files/} - (Configuratie) bestanden
  \item<4-> \texttt{scripts/} - Scripts
  \item<5-> \texttt{hooks/} - Hooks
  \item<6-> \light{\texttt{debconf/} - Debconf antwoorden}
  \item<6-> \light{\texttt{disk\_config/} - Disklayouts}
  \item<6-> \light{\texttt{basefiles/} - Basis bestanden archief}
  \item<6-> \light{\texttt{pkgs/} - Lokale pakketten}
  \item<6-> \light{\texttt{tests/} - Tests}
\end{itemize}
\end{frame}

\section{FAI fasen}
\begin{frame}
\frametitle{FAI fasen}
\begin{itemize}
  \item<2-> \light{\textsc{confdir} - get the config space}
  \item<2-> \light{\textsc{setup}                 - some initialization, start sshd on demand}
  \item<2-> \textsc{defclass}              - define FAI classes
  \item<2-> \textsc{defvar}                - define variables
  \item<3-> \light{\textsc{action}                - evaluate FAI\_ACTION}
  \item<3-> \light{\textsc{install}               - Start the installation}
  \item<3-> \textsc{partition}             - partition the harddisks, create file systems
  \item<4-> \light{\textsc{mountdisks}            - mount the file systems}
  \item<4-> \light{\textsc{extrbase}              - extract the base.tar.xz}
  \item<4-> \textsc{debconf}               - do the Debian debconf preseeding
  \item<5-> \light{\textsc{repository}            - prepare access to the package repository}
  \item<5-> \light{\textsc{updatebase}            - Set up package tools and update packages}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{FAI fasen (vervolg)}
\begin{itemize}
  \item \textbf{\textsc{instsoft}              - install software packages}
  \item<2-> \textbf{\textsc{configure}             - call customization scripts}
  \item<3-> \light{\textsc{finish}                - do some cleanup, show installation statistics}
  \item<3-> \textsc{tests}                 - call tests if defined
  \item<3-> \light{\textsc{chboot}                - call fai-chboot on the install server}
  \item<3-> \light{\textsc{savelog}               - save log files to local and remote location}
  \item<3-> \light{\textsc{faiend}                - reboot host, eject CD if needed}
\end{itemize}
\end{frame}

\section{Voorbeelden}

\begin{frame}[fragile]
\frametitle{Voorbeeld FANCY\_BASH\_PROMPT}
 
\textbf{Probleem:} \texttt{/etc/bash.bashrc} moet worden aangepast

\onslide<2->{\textbf{Oplossing:}}
\begin{itemize}
  \item<2-> Maak een bestand \texttt{files/etc/bash.bashrc/FANCY\_BASH\_PROMPT} met de aanpassingen
  \item<3-> Maak een script \texttt{scripts/FANCY\_BASH\_PROMPT/10-copy-file} met:
  \begin{verbatim}#!/bin/bash
fcopy -M /etc/bash.bashrc
  \end{verbatim} 
   
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Voorbeeld UNATTENDED\_UPGRADES}
 
\textbf{Probleem:} 
\begin{itemize}
  \item Pakket \texttt{unattended-upgrades} moet worden geïnstalleerd
  \item Onbeheerde updates moeten worden ingeschakeld
  \item Configuratie om van alle bronnen updates te accepteren
\end{itemize}

\onslide<2->{\textbf{Oplossing:}}
\begin{itemize}
  \item<2-> Maak een bestand \texttt{package\_config/UNATTENDED\_UPGRADES} met:
  \begin{verbatim}PACKAGES install
unattended-upgrades
  \end{verbatim} 
  \item<3-> Maak een bestand \texttt{files/debconf/UNATTENDED\_UPGRADES} met:
  \begin{verbatim}unattended-upgrades \
    unattended-upgrades/enable_auto_updates \
      boolean true
  \end{verbatim}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Voorbeeld UNATTENDED\_UPGRADES (vervolg)}
\onslide{\textbf{Oplossing (vervolg):}}
\begin{itemize}
  \item<2-> Maak een bestand \texttt{files/etc/apt/apt.conf.d/\symbol{92}} \texttt{52unattended-upgrades-local/UNATTENDED\_UPGRADES} met de configuratie
  \begin{verbatim}Unattended-Upgrade::Origins-Pattern {
        "origin=*";
 };
  \end{verbatim}
  \item<3-> Maak een script \texttt{scripts/UNATTENDED\_UPGRADES/10-configuration} met:
  \begin{verbatim}#!/bin/bash
fcopy /apt/apt.conf.d/52unattended-upgrades-local
  \end{verbatim}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Voorbeeld MATTERMOST}
\textbf{Probleem:} 
Je wilt Mattermost installeren, maar het zit niet standaard in Debian. Gelukkig heeft \texttt{extrepo} een bron hiervoor

\onslide<2->{\textbf{Conceptuele oplossing:}}
\begin{itemize}
  \item<3-> Installeer \texttt{extrepo}
  \item<4-> Voeg de Mattermost bron toe
  \item<5-> Installeer het pakket
\end{itemize}
\end{frame}
\begin{frame}[fragile]
\frametitle{Voorbeeld MATTERMOST (vervolg)}
\textbf{Concrete oplossing:}
\begin{itemize}
  \item<2-> Maak een bestand \texttt{class/MATTERMOST.deps} met:
  \begin{verbatim}EXTREPO
  \end{verbatim}
  \item<3-> Maak een bestand \texttt{hooks/instsoft.MATTERMOST} met de inhoud:
  \begin{verbatim}#! /bin/bash
$ROOTCMD extrepo enable mattermost
$ROOTCMD apt-get update
  \end{verbatim}
  \item<4-> Maak een bestand \texttt{package\_config/MATTERMOST} met:
  \begin{verbatim}PACKAGES install
mattermost-desktop
\end{verbatim} 
  \end{itemize}
\end{frame}

\section{Profielen}

\begin{frame}
\frametitle{Profielen}
Een profiel heeft:
\begin{itemize}
  \item<2-> Naam
  \item<3-> Beschrijving
  \item<4-> Een \textbf{geordende} lijst van \textbf{classes}
\end{itemize}

\onslide<5->{Profielen kunnen zijn voor:}
  \begin{itemize}
    \item<5-> Desktop
    \item<5-> Server
    \item<5-> Laptop
    \item<5-> Specifiek voor een gebruiker
    \item<5-> Specifiek voor een groep gebruikers
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Voorbeeld profiel `Gnome developer'}
Inhoud van het bestand \texttt{class/gnome-developer.profile}:
\begin{verbatim}
Name: Gnome developer
Description: Gnome desktop met developer tools
(...)
Classes: INSTALL FAIBASE DEBIAN DUTCH CONSOLE_TWEAKS \
  ADVANCED_CLI_TOOLS TUX GNOME_CORE BACKGROUND \
  FIREFOX MATTERMOST DEVELOPER 
\end{verbatim}
\end{frame}

\section{Over deze presentatie}

\begin{frame}
\frametitle{Over deze presentatie}
\begin{itemize}
  \item Broncode: \url{https://github.com/slspeek/presentatie-fai}
  \item PDFs: \url{https://github.com/slspeek/presentatie-fai/releases/latest}
  \item Gemaakt met \href{https://nl.mirrors.cicku.me/ctan/macros/latex/contrib/beamer/doc/beameruserguide.pdf}{\LaTeX{} beamer}
  \item Experimenteren met \LaTeX{} beamer: \url{https://github.com/slspeek/empty-latex-beamer}
  \begin{itemize}
    \item Productie van PDFs via \LaTeX{} dockerimage
    \item Github Actions workflow met releases
  \end{itemize}
\end{itemize}
\end{frame}

\section{Vragen}
\begin{frame}
\frametitle{Vragen?}
\begin{itemize}
  \item Vragen?
  \item<2-> Opmerkingen?
  \item<3-> Verbeteringen?
\end{itemize}
\end{frame}

\end{document}